# Tailored for wekadocs-matrix: runs the Neo4j Cypher MCP server
# on the same Docker network as your database so it can use Bolt
# directly without exposing extra ports.

networks:
  weka-net:
    external: true
    name: weka-net

services:
  neo4j-cypher-mcp:
    # Build from source to avoid registry auth issues
    build:
      # Use the server subdirectory as the build context so COPY src/ works
      context: https://github.com/neo4j-contrib/mcp-neo4j.git#main:servers/mcp-neo4j-cypher
      dockerfile: Dockerfile
    image: mcp-neo4j-cypher:local
    container_name: weka-neo4j-cypher-mcp
    networks:
      - weka-net
    environment:
      # Use the existing network-attached Neo4j container.
      # Prefer the service name 'neo4j' for cross-project reliability.
      - NEO4J_URI=${NEO4J_URI:-bolt://neo4j:7687}
      - NEO4J_URL=${NEO4J_URL:-bolt://neo4j:7687}
      # Provide both common username env keys to be safe across variants
      - NEO4J_USERNAME=${NEO4J_USER:-neo4j}
      - NEO4J_USER=${NEO4J_USER:-neo4j}
      - NEO4J_PASSWORD=${NEO4J_PASSWORD}
      # Optional if you use multi-database
      # - NEO4J_DATABASE=${NEO4J_DATABASE:-neo4j}
      # Logging level for the MCP server
      - LOG_LEVEL=${LOG_LEVEL:-info}

    # Keep stdin open for Codex stdio launch; do not allocate a TTY
    stdin_open: true
    tty: false

    # no automatic restart while debugging boot issues
    # restart: unless-stopped

# Notes
# - Ensure the external network exists: `docker network ls | grep weka-net`
#   If missing, create it: `docker network create weka-net`
# - The credentials come from your repo .env (NEO4J_USER/NEO4J_PASSWORD).
# - If your DB enforces TLS or is remote, set NEO4J_URI to bolt+s:// or neo4j+s://.
